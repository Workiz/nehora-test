name: hot fix
on:
  workflow_dispatch:

jobs:
  hot-fix:
    name: hot-fix
    runs-on: ubuntu-latest
    steps:
    - name: Checkout 
      uses: actions/checkout@v3
      with: 
        fetch-depth: 0
    - run: |-
        echo "open workiz.com pr"
        curl -X POST -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
        https://api.github.com/repos/Workiz/nehora-test/pulls \
        -d '{"title":"Amazing new feature","body":"Please pull these awesome changes in!","head":"'$GITHUB_REF'","base":"workiz.com"}'
        git config --global --add safe.directory /github/workspace

        if [[ "'$GITHUB_REF'" =~ ^v[0-9]\.([0-9]*)?(-hf[0-9]*)?-branch$ ]]; then  
            branch_number=${BASH_REMATCH[1]}
        fi
        rc_number=$((branch_number+1))
        echo "rc_number $rc_number"
        branch=$(curl -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
        https://api.github.com/repos/Workiz/nehora-test/branches/rc3.$rc_number-branch)
        echo "branch $branch"
        
        if [[ branch ]]; then
          echo "open rc pr"
          curl -X POST -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
          https://api.github.com/repos/Workiz/nehora-test/pulls \
          -d '{"title":"Amazing new feature","body":"Please pull these awesome changes in!","head":"'$GITHUB_REF'","base":"'rc3.$rc_number-branch'"}'
        fi
